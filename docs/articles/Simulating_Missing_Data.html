<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="https://centerforassessment.github.io/assets/favicon.png" sizes="16x16">
<meta property="og:title" content="cfaTools • Simulating Missing Data with amputeScaleScore">
<meta property="og:description" content="cfaTools • Simulating Missing Data with amputeScaleScore">
<meta property="og:type" content="website">
<meta property="og:url" content="https://centerforassessment.github.io/cfaTools">
<meta property="og:image" content="https://centerforassessment.github.io/assets/favicon.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@NCIEA1">
<meta name="twitter:creator" content="@dbetebenner">
<meta name="twitter:image" content="https://centerforassessment.github.io/assets/favicon.png">
<meta name="twitter:title" content="cfaTools • Simulating Missing Data with amputeScaleScore">
<meta name="twitter:description" content="cfaTools • Simulating Missing Data with amputeScaleScore">
<title>cfaTools • Simulating Missing Data with amputeScaleScore</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- Fonts --><link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400" rel="stylesheet" type="text/css">
<!-- packagePages --><link href="../packagePages.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- gist-embed --><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.4/gist-embed.min.js"></script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="https://centerforassessment.github.io"></a><a class="navbar-label" href="../index.html">cfaTools</a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/cfaTools.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fair_trend.html">Exploring Ho's Fair Trend Metric</a>
    </li>
    <li>
      <a href="../articles/Simulating_Missing_Data.html">Simulating Missing Data with amputeScaleScore</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Release notes</li>
    <li>
      <a href="../articles/releases/cfaTools-0.0-1.0.html">cfaTools 0.0-1.0</a>
    </li>
    <li>
      <a href="../articles/releases/cfaTools-0.0-0.5.html">cfaTools 0.0-0.5</a>
    </li>
    <li>
      <a href="../articles/releases/cfaTools-0.0-0.1.html">cfaTools 0.0-0.1</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/centerforassessment/cfaTools">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
   <a style="cursor:pointer" onclick="window.open('https://twitter.com/intent/tweet?url=https%3A%2F%2Fcenterforassessment.github.io%2FcfaTools&amp;via=NCIEA1&amp;text=cfaTools%3A%20Center%20for%20Assessment%20R%20Tools%20for%20Large%20Scale%20Educational%20Assessment%20Analysis&amp;hashtags=cfaTools%2Crstats','','scrollbars=0,menubar=0,height=300,width=600,resizable=0,toolbar=0,location=0,status=0')">
    <span class="fab fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="Simulating_Missing_Data_files/header-attrs-2.9.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Simulating Missing Data with amputeScaleScore</h1>
                        <h4 class="author">Adam Van Iwaarden</h4>
            
            <h4 class="date">June 10, 2021</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h1>
<p>In preparation for the analysis of student assessment data in 2021, and given the assumption of reduced test participation in many states due to the ongoing COVID-19 pandemic, simulations of missing data that produce varying degrees and patterns of missingness were required. The <code>amputeScaleScore</code> function allows for customized simulation of data missing completely at random (MCAR), missing at random (MAR) and missing not at random (MNAR). These patterns can be specified to depend on a variety of student and institutional level variables.</p>
<p>This vignette provides a brief introduction of how to use the <code>amputeScaleScore</code> function to simulate, explore and analyze missing data patterns using the <code>sgpData_LONG_COVID</code> data from the the <a href="https://github.com/CenterForAssessment/SGPdata">SGPData</a> package. This simulated data conforms to the data naming and structure that is <a href="https://centerforassessment.github.io/SGPdata/reference/index.html#section-data-sets-for-higher-level-sgp-functions">required for data</a> analysis using the <a href="https://github.com/CenterForAssessment/SGP">SGP package</a>.</p>
</div>
<div id="function-arguments" class="section level1">
<h1 class="hasAnchor">
<a href="#function-arguments" class="anchor" aria-hidden="true"></a>Function Arguments</h1>
<p>The following provides an explanation of the arguments a user can provide in the <code>amputeScaleScore</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(cfaTools)</span></code></pre></div>
<pre><code>## Loading required package: cfaTools</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">args</span>(amputeScaleScore)</span></code></pre></div>
<pre><code>## function (ampute.data, additional.data = NULL, compact.results = FALSE, 
##     growth.config = NULL, status.config = NULL, default.vars = c("CONTENT_AREA", 
##         "GRADE", "SCALE_SCORE", "ACHIEVEMENT_LEVEL"), demographics = NULL, 
##     institutions = NULL, ampute.vars = NULL, ampute.var.weights = NULL, 
##     reverse.weight = "SCALE_SCORE", ampute.args = list(prop = 0.3, 
##         type = "RIGHT"), complete.cases.only = TRUE, partial.fill = TRUE, 
##     invalidate.repeater.dups = TRUE, seed = 4224L, M = 10) 
## NULL</code></pre>
<ul>
<li>
<code>ampute.data</code>
<ul>
<li>The complete dataset in which to create missing values</li>
<li>Here the COVID impacted dataset from SGPdata: <code>SGPdata::sgpData_LONG_COVID</code>
</li>
</ul>
</li>
<li>
<code>additional.data = NULL</code>
<ul>
<li>The function will return only data that is required for a SGP analysis (based on <code>growth.config</code>) or a status analysis (based on <code>status.config</code>). This allows for the addition of more data (e.g. 2019 grades not used as priors).</li>
</ul>
</li>
<li>
<code>compact.results = FALSE</code>
<ul>
<li>By default (<code>FALSE</code>), the function will return a list of longitudinal datasets with the current (amputed) and prior (unchanged) student records. This is helpful for diagnostics and ease of use, but also produces redundant prior data. Setting this argument to <code>TRUE</code> returns a single <code>data.table</code> object with a TRUE/FALSE indicator column added for each requested amputation. This flag can be used to make the <code>SCALE_SCORE</code> (and/or other variables) <code>NA</code> in subsequent use cases.</li>
</ul>
</li>
<li>
<code>growth.config = NULL</code>
<ul>
<li>An elongated SGP config script. This needs to have an entry for each grade/content_area/year cohort that will be analyzed in subsequent simulations.</li>
</ul>
</li>
<li>
<code>status.config = NULL</code>
<ul>
<li>An elongated SGP config script. This needs to have an entry for each grade/content_area/year cohort that will be analyzed in subsequent simulations.</li>
<li>Unlike a <code>growth.config</code> entry, <code>status.config</code> entries use data from the same grade, but from a prior year (i.e. not individual variables). For example you might predict missing 2021 3rd grade ELA scores based on 2019 3rd grade school mean scale score, FRL status, etc.</li>
</ul>
</li>
<li>
<code>default.vars = c("CONTENT_AREA", "GRADE", "SCALE_SCORE", "ACHIEVEMENT_LEVEL")</code>
<ul>
<li>variables that will be used in extracting cohort records (subject and grade) and other variables from the data that the user may want returned in the amputed data.</li>
</ul>
</li>
<li>
<code>demographics = NULL</code>
<ul>
<li>Demographic (factor/character) variables to use and/or return in the final dataset.</li>
<li>For example: <code>c("FREE_REDUCED_LUNCH_STATUS", "ELL_STATUS", "IEP_STATUS", "ETHNICITY", "GENDER")</code>
</li>
</ul>
</li>
<li>
<code>institutions = NULL</code>
<ul>
<li>Institution IDs that will be used/or returned in the amputed data.</li>
<li>For example: <code>c("SCHOOL_NUMBER", "DISTRICT_NUMBER")</code>
</li>
</ul>
</li>
<li>
<code>ampute.vars = NULL</code>
<ul>
<li>Intersection of <code>default.vars</code>, <code>demographics</code> and <code>institutions</code> that will be used in the construction of the weighted scores that define the probability of being missing. Any institution included will be used to construct institution level means of other student level <code>ampute.vars.</code>
</li>
<li>For example, with <code>c("SCHOOL_NUMBER", "SCALE_SCORE", "FREE_REDUCED_LUNCH_STATUS")</code>, student level scores and demographics will be used along with their associated school level mean scores and proportion FRL (4 total factors).</li>
<li>The default (<code>NULL</code>) means that no factors are considered, creating a “missing completely at random” (MCAR) missing data pattern.</li>
</ul>
</li>
<li>
<code>ampute.var.weights = NULL</code>
<ul>
<li>Relative weights assigned to the <code>ampute.vars</code>. Default is <code>NULL</code> meaning the weighted sum scores will be calculated with equal weight (=1). A named list can be provided with the desired relative weights. For example, <code>list(SCALE_SCORE=3, FREE_REDUCED_LUNCH_STATUS=2, SCHOOL_NUMBER=1)</code> will weight a student’s scale scores by a factor of 3 and FRL by 2, with all (any other <code>ampute.vars</code>) remaining at the default of 1.</li>
<li>School level aggregates are included in the example above. Note that differential weights for institutions should be placed at the end of the list. If institution IDs (e.g., SCHOOL_NUMBER) are omitted from the list, the aggregates will be given the same weight as the associated student level variable. In the given example, <code>SCALE_SCORE</code> and school mean scale score would be given a relative weight of 3.</li>
<li>This argument is ignored when <code>ampute.vars = NULL</code>.</li>
</ul>
</li>
<li>
<code>reverse.weight = "SCALE_SCORE"</code>
<ul>
<li>The current default for <code>ampute.args$type</code> is <code>"RIGHT"</code>, which means that students with high weighted scores have the highest probability for amputation.<br>
This makes sense for high % FRL schools, but not for high achieving students and/or students in high achieving schools. This function inverses the variable(s) individual (and institutional mean) value(s) so that higher weight is given to lower scores/means.</li>
<li>This argument is ignored when <code>ampute.vars = NULL</code>.</li>
</ul>
</li>
<li>
<code>ampute.args = list(prop=0.3, type="RIGHT")</code>
<ul>
<li>variables to be used in the <code>mice:ampute.continuous</code> function. Currently only <code>prop</code> and <code>type</code> can be modified. See <code>?mice::ampute.continuous</code> and <code>?mice::ampute</code> for more information.</li>
<li>The <code>prop</code> argument is inexact and has required some modification. Although performance has been improved, it is still imprecise, particularly for values away from 0.5 (50% missing). Also, the max missingness is 85%, and for that the user needs to set <code>prop=0.95</code> or greater.</li>
<li>Note that <code>prop</code> gives a total proportion missing, which accounts for missingness already included in the data due to students with incomplete longitudinal data histories. For example, if a cohort starts with 5% students missing due to incomplete histories, an additional 25% will be made missing to get to the 30% (default) missingness.</li>
<li>This last point has been dealt with in some regards with the next argument, which removes these cases first.</li>
</ul>
</li>
<li>
<code>complete.cases.only = TRUE</code>
<ul>
<li>Should cases without the most recent prior and current score be removed?</li>
<li>This removes students with partial longitudinal histories from the most recent prior (e.g., 2019) to the current year (e.g., 2021), producing a “complete” dataset that is easier to interpret and use in subsequent imputation simulations.</li>
</ul>
</li>
<li>
<code>partial.fill = TRUE</code>
<ul>
<li>Should an attempt be made to fill in some of the demographic and institution ID information based on students previous values?</li>
<li>Part of the process of the <code>amputeScaleScore</code> function is to take the long data (<code>ampute.data</code>) and then first widen and then re-lengthen the data, which creates holes for students with incomplete longitudinal records. This part of the function fills in these holes for students with existing missing data.</li>
</ul>
</li>
<li>
<code>invalidate.repeater.dups = TRUE</code>
<ul>
<li>Students who repeat a grade will get missing data rows inserted for the grade that they “should” be in in 2021. This leads to duplicated cases that can lead to problems in the SGP analyses. This argument returns those cases with the <code>VALID_CASE</code> variable set to <code>"INVALID_CASE"</code>.</li>
</ul>
</li>
<li>
<code>seed = 4224L</code>
<ul>
<li>A random seed set for the amputation process to allow for replication of results, or for alternative results using the same code.</li>
</ul>
</li>
<li>
<code>M = 10</code>
<ul>
<li>The number of amputed datasets to return. The default is 10.</li>
</ul>
</li>
</ul>
<p>Depending on the amputation process specified, the function returns either a list (default) of <code>M</code> amputed datasets or a single data set with <code>M</code> columns of missing record indicators. The datasets will exclude data for students not used in any of the specified <code>growth.config</code> or <code>status.config</code> cohorts, unless the <code>additional.data</code> argument has been included.</p>
<div id="example-workflow-of-creating-missing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-workflow-of-creating-missing-data" class="anchor" aria-hidden="true"></a>Example workflow of creating missing data</h2>
<p>The sgpData_LONG_COVID object contains simulated data from 2016 to 2023. The data follows the same format as the example <a href="https://sgp.io/articles/SGP_Data_Preparation.html#long-data-format-sgpdata_long">long data</a> from the SGP package. The dataset is 7 years of annual assessment data in two content areas (ELA and Mathematics) and is missing 2020 data to help users model COVID related interruptions to student status and growth. The data comes with a “built in” impact in 2021 related to the pandemic (although an unperturbed version - <code>"SCALE_SCORE_without_COVID_IMPACT"</code> is also available so that different impact scenarios can be modeled).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">###   Load packages</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(data.table)</span></code></pre></div>
<pre><code>## Loading required package: data.table</code></pre>
<p>We will use a copy of the ELA data from the SGPdata::sgpData_LONG_COVID dataset. We will also add duplicate <code>SCALE_SCORE</code> and <code>ACHIEVEMENT_LEVEL</code> variables to compare with what has been amputated (named <code>SCALE_SCORE_COMPLETE</code> and <code>ACH_LEV_COMPLETE</code>).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  data_to_ampute <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      data.table<span class="sc">::</span><span class="fu">copy</span>(SGPdata<span class="sc">::</span>sgpData_LONG_COVID)[CONTENT_AREA <span class="sc">==</span> <span class="st">"ELA"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                       SCALE_SCORE_COMPLETE <span class="sc">:</span><span class="er">=</span> SCALE_SCORE][,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                       ACH_LEV_COMPLETE <span class="sc">:</span><span class="er">=</span> ACHIEVEMENT_LEVEL]</span></code></pre></div>
<p>Next we create the required configuration scripts. Here is an example of the “status only” grade configurations. That is, grades 3 and 4 will not have prior scores from 2020 available to use as either a factor in score amputation/imputation or in student growth analyses.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">###   ELA 2021 status configurations for amputeScaleScore</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  status_config_2021 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ELA.2021 =</span> <span class="fu">list</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.content.areas =</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">2</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.panel.years =</span> <span class="fu">c</span>(<span class="st">"2019"</span>, <span class="st">"2021"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.grade.sequences =</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"3"</span>)),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ELA.2021 =</span> <span class="fu">list</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.content.areas =</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">2</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.panel.years =</span> <span class="fu">c</span>(<span class="st">"2019"</span>, <span class="st">"2021"</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.grade.sequences =</span> <span class="fu">c</span>(<span class="st">"4"</span>, <span class="st">"4"</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">###   ELA 2021 growth configurations for amputeScaleScore</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  growth_config_2021 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ELA.2021 =</span> <span class="fu">list</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.content.areas =</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">2</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.panel.years =</span> <span class="fu">c</span>(<span class="st">"2019"</span>, <span class="st">"2021"</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.grade.sequences =</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"5"</span>)),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ELA.2021 =</span> <span class="fu">list</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.content.areas =</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">3</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.panel.years =</span> <span class="fu">c</span>(<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2021"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.grade.sequences =</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"6"</span>)),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ELA.2021 =</span> <span class="fu">list</span>(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.content.areas =</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">3</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.panel.years =</span> <span class="fu">c</span>(<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2021"</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.grade.sequences =</span> <span class="fu">c</span>(<span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"7"</span>)),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ELA.2021 =</span> <span class="fu">list</span>(</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.content.areas =</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">3</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.panel.years =</span> <span class="fu">c</span>(<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2021"</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">sgp.grade.sequences =</span> <span class="fu">c</span>(<span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"8"</span>))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="a-quick-example-run" class="section level3">
<h3 class="hasAnchor">
<a href="#a-quick-example-run" class="anchor" aria-hidden="true"></a>A quick example run</h3>
<p>To begin with we will run a quick test using the package defaults along with the augmented data and config scripts we just read in. The following script creates a single amputed dataset (which takes about as long as 10!).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Test_Data_LONG <span class="ot">&lt;-</span> <span class="fu">amputeScaleScore</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ampute.data =</span> data_to_ampute,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">growth.config =</span> growth_config_2021,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">status.config =</span> status_config_2021,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">M=</span><span class="dv">1</span>)</span></code></pre></div>
<p>We can inspect the results quickly to verify that we have a list with a single (<code>data.table</code>) object</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(Test_Data_LONG)</span></code></pre></div>
<pre><code>## [1] "list"</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(Test_Data_LONG)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(Test_Data_LONG[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] "data.table" "data.frame"</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(Test_Data_LONG[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 89164     7</code></pre>
<p>We will also make sure the proportion missing matches the <code>ampute.args$prop</code> value default (0.3).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Test_Data_LONG[[<span class="dv">1</span>]][YEAR <span class="sc">==</span> <span class="st">"2021"</span> <span class="sc">&amp;</span> VALID_CASE <span class="sc">==</span> <span class="st">"VALID_CASE"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">list</span>(<span class="at">NAs =</span> <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(SCALE_SCORE))<span class="sc">/</span>.N, <span class="dv">3</span>)),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                      keyby<span class="ot">=</span><span class="fu">list</span>(CONTENT_AREA, GRADE)]</span></code></pre></div>
<pre><code>##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.303
## 2:          ELA     4 0.300
## 3:          ELA     5 0.302
## 4:          ELA     6 0.307
## 5:          ELA     7 0.304
## 6:          ELA     8 0.306</code></pre>
<p>Note that the observed missingness is near the intended (30%). The <code>mice::ampute.continuous</code> function does a decent job around 30% - 50% and worse the further away you get from there! Corrections for this have been implemented, but it’s still a bit off. Depending on the desired precision, users will need to experiment with <code>ampute.args$prop</code> argument values. The maximum proportion missing is currently around 85%. Hopefully that extreme enough…</p>
</div>
<div id="a-more-detailed-amputation" class="section level3">
<h3 class="hasAnchor">
<a href="#a-more-detailed-amputation" class="anchor" aria-hidden="true"></a>A more detailed amputation</h3>
<p>Note that the <code>amputeScaleScore</code> does not return 2019 scores not used as priors.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(Test_Data_LONG[[<span class="dv">1</span>]][, GRADE, YEAR])</span></code></pre></div>
<pre><code>##       GRADE
## YEAR      3    4    5    6    7    8
##   2018 7153 6774 6502    0    0    0
##   2019 6732 7153 6774 6502    0    0
##   2021 6607 7806 6732 7153 6774 6502</code></pre>
<p>We may want to add in 2019 priors (and we could also add in 2018 grades 6 to 8) for some status and growth comparisons from 2019. We will manually add those in to the amputed data via the <code>additional.data</code> argument.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  priors_to_add <span class="ot">&lt;-</span> data_to_ampute[YEAR <span class="sc">==</span> <span class="st">"2019"</span> <span class="sc">&amp;</span> GRADE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"7"</span>, <span class="st">"8"</span>)]</span></code></pre></div>
<p>We also want to produce an interesting missingness pattern. For example, here we will simulate missingness that is correlated with (low) achievement and economic disadvantage (as indicated by Free/Reduced lunch status). We will also assume that these factors are compounded by the school level concentration of low achievement and economic disadvantage.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  my.amp.vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SCHOOL_NUMBER"</span>, <span class="st">"SCALE_SCORE"</span>, <span class="st">"FREE_REDUCED_LUNCH_STATUS"</span>)</span></code></pre></div>
<p>Specify the number of amputed data sets to create - 10 is the default.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  MM <span class="ot">&lt;-</span> <span class="dv">10</span></span></code></pre></div>
<p>We will also add in the additional variable names that we want returned in the data (<code>SCALE_SCORE_COMPLETE</code> and <code>ACH_LEV_COMPLETE</code>) in the <code>default.vars</code> argument.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Run 10 amputations with added priors</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Test_Data_LONG <span class="ot">&lt;-</span> <span class="fu">amputeScaleScore</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ampute.data =</span> data_to_ampute,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">additional.data =</span> priors_to_add,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">growth.config =</span> growth_config_2021,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">status.config =</span> status_config_2021,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">M=</span>MM,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">default.vars =</span> <span class="fu">c</span>(<span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"SCALE_SCORE"</span>, <span class="st">"SCALE_SCORE_COMPLETE"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"ACHIEVEMENT_LEVEL"</span>, <span class="st">"ACH_LEV_COMPLETE"</span>),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">demographics =</span> <span class="fu">c</span>(<span class="st">"FREE_REDUCED_LUNCH_STATUS"</span>, <span class="st">"ELL_STATUS"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"IEP_STATUS"</span>, <span class="st">"ETHNICITY"</span>, <span class="st">"GENDER"</span>),</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">institutions =</span> <span class="fu">c</span>(<span class="st">"SCHOOL_NUMBER"</span>, <span class="st">"DISTRICT_NUMBER"</span>),</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ampute.vars =</span> my.amp.vars)</span></code></pre></div>
<p>All 2019 prior scores are now added:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Test_Data_LONG[[<span class="dv">3</span>]][, GRADE, YEAR])</span></code></pre></div>
<pre><code>##       GRADE
## YEAR       3     4     5     6     7     8
##   2018  7153  6774  6502     0     0     0
##   2019  6732  7153  6774  6502 13794 13438
##   2021  6607  7806  6732  7153  6774  6502</code></pre>
<p>Inspect score missingness for all amputations. Look at both the raw number missing in each grade and the proportions as well to verify.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">##  Total missing scores in 2021 (note that we still have their "actual" score)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(Test_Data_LONG[[<span class="dv">3</span>]][<span class="fu">is.na</span>(SCALE_SCORE) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(SCALE_SCORE_COMPLETE), GRADE, YEAR])</span></code></pre></div>
<pre><code>##       GRADE
## YEAR      3    4    5    6    7    8
##   2021 2014 2381 2066 2226 2016 2010</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">##  Proportion missing scores in 2021 by GRADE</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="fu">seq</span>(MM)) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(Test_Data_LONG[[m]][YEAR <span class="sc">==</span> <span class="st">"2021"</span> <span class="sc">&amp;</span> VALID_CASE <span class="sc">==</span> <span class="st">"VALID_CASE"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">NAs =</span> <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(SCALE_SCORE))<span class="sc">/</span>.N, <span class="dv">3</span>)),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">keyby=</span><span class="fu">list</span>(CONTENT_AREA, GRADE)])</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<pre><code>##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.307
## 2:          ELA     4 0.313
## 3:          ELA     5 0.306
## 4:          ELA     6 0.313
## 5:          ELA     7 0.301
## 6:          ELA     8 0.304
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.295
## 2:          ELA     4 0.309
## 3:          ELA     5 0.306
## 4:          ELA     6 0.309
## 5:          ELA     7 0.302
## 6:          ELA     8 0.309
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.305
## 2:          ELA     4 0.305
## 3:          ELA     5 0.307
## 4:          ELA     6 0.311
## 5:          ELA     7 0.298
## 6:          ELA     8 0.309
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.311
## 2:          ELA     4 0.315
## 3:          ELA     5 0.306
## 4:          ELA     6 0.308
## 5:          ELA     7 0.304
## 6:          ELA     8 0.313
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.304
## 2:          ELA     4 0.312
## 3:          ELA     5 0.298
## 4:          ELA     6 0.313
## 5:          ELA     7 0.304
## 6:          ELA     8 0.309
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.309
## 2:          ELA     4 0.308
## 3:          ELA     5 0.303
## 4:          ELA     6 0.296
## 5:          ELA     7 0.303
## 6:          ELA     8 0.301
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.295
## 2:          ELA     4 0.308
## 3:          ELA     5 0.298
## 4:          ELA     6 0.311
## 5:          ELA     7 0.305
## 6:          ELA     8 0.309
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.311
## 2:          ELA     4 0.304
## 3:          ELA     5 0.305
## 4:          ELA     6 0.308
## 5:          ELA     7 0.296
## 6:          ELA     8 0.305
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.310
## 2:          ELA     4 0.312
## 3:          ELA     5 0.304
## 4:          ELA     6 0.307
## 5:          ELA     7 0.302
## 6:          ELA     8 0.313
##    CONTENT_AREA GRADE   NAs
## 1:          ELA     3 0.301
## 2:          ELA     4 0.317
## 3:          ELA     5 0.310
## 4:          ELA     6 0.307
## 5:          ELA     7 0.305
## 6:          ELA     8 0.310</code></pre>
</div>
</div>
</div>
<div id="missing-data-explorationvisualization" class="section level1">
<h1 class="hasAnchor">
<a href="#missing-data-explorationvisualization" class="anchor" aria-hidden="true"></a>Missing data exploration/visualization</h1>
<p>Now that we have some amputated data, we should evaluate it to make sure it looks like what we wanted. In our assumptions, we expect to see more missing data for students with lower 2019 scale scores, who are FRL, etc. The following visualization from the <code>VIM</code> package are helpful in exploring. See the VIM package for more context on these plots. In general, blue means observed data, red means missing. A good introduction is given <a href="https://www.datacamp.com/community/tutorials/visualize-data-vim-package">here</a>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(VIM)</span></code></pre></div>
<pre><code>## Loading required package: VIM</code></pre>
<pre><code>## Loading required package: colorspace</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## VIM is ready to use.</code></pre>
<pre><code>## Suggestions and bug-reports can be submitted at: https://github.com/statistikat/VIM/issues</code></pre>
<pre><code>## 
## Attaching package: 'VIM'</code></pre>
<pre><code>## The following object is masked from 'package:datasets':
## 
##     sleep</code></pre>
<p>Visualizations are easier with WIDE data, so we’ll widen our datasets first.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>  long.to.wide.vars <span class="ot">&lt;-</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"GRADE"</span>, <span class="st">"SCALE_SCORE"</span>, <span class="st">"SCALE_SCORE_COMPLETE"</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"FREE_REDUCED_LUNCH_STATUS"</span>, <span class="st">"ELL_STATUS"</span>, <span class="st">"ETHNICITY"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">###  Create a wide data set from each M amputated data sets</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  Test_Data_WIDE <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> MM)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="fu">seq</span>(MM)) {</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]] <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>      Test_Data_LONG[[m]][VALID_CASE <span class="sc">==</span> <span class="st">"VALID_CASE"</span> <span class="sc">&amp;</span> YEAR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2019"</span>, <span class="st">"2021"</span>)],</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        ID <span class="sc">+</span> CONTENT_AREA <span class="sc">~</span> YEAR, <span class="at">sep=</span><span class="st">"."</span>, <span class="at">drop=</span><span class="cn">FALSE</span>, <span class="at">value.var=</span>long.to.wide.vars)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Trim data of (107) cases with no data in 2019 or 2021</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]] <span class="ot">&lt;-</span> Test_Data_WIDE[[m]][<span class="sc">!</span>(<span class="fu">is.na</span>(GRADE<span class="fl">.2019</span>) <span class="sc">&amp;</span> <span class="fu">is.na</span>(GRADE<span class="fl">.2021</span>))]</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Fill in GRADE according to our expectations of normal progression</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][<span class="fu">is.na</span>(GRADE<span class="fl">.2019</span>), GRADE<span class="fl">.2019</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(GRADE<span class="fl">.2021</span>)<span class="sc">-</span>2L]</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][<span class="fu">is.na</span>(GRADE<span class="fl">.2021</span>), GRADE<span class="fl">.2021</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(GRADE<span class="fl">.2019</span>)<span class="sc">+</span>2L]</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Exclude irrelevant GRADE levels</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]] <span class="ot">&lt;-</span> Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>] <span class="co"># Current relevant GRADEs</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][<span class="sc">!</span>GRADE<span class="fl">.2019</span> <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, GRADE<span class="fl">.2019</span> <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>] <span class="co"># Clean up prior GRADEs</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Fill some more (but not all) - Demographics used in missing data plots ONLY</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][<span class="fu">is.na</span>(FREE_REDUCED_LUNCH_STATUS<span class="fl">.2019</span>), FREE_REDUCED_LUNCH_STATUS<span class="fl">.2019</span> <span class="sc">:</span><span class="er">=</span> FREE_REDUCED_LUNCH_STATUS<span class="fl">.2021</span>]</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][<span class="fu">is.na</span>(ELL_STATUS<span class="fl">.2019</span>), ELL_STATUS<span class="fl">.2019</span> <span class="sc">:</span><span class="er">=</span> ELL_STATUS<span class="fl">.2021</span>]</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][<span class="fu">is.na</span>(ETHNICITY<span class="fl">.2019</span>), ETHNICITY<span class="fl">.2019</span> <span class="sc">:</span><span class="er">=</span> ETHNICITY<span class="fl">.2021</span>]</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Start by looking at demographic variables. Here iss missing in 2021 given 2019 <code>ETHNICITY</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spineMiss</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][, <span class="fu">c</span>(<span class="st">"ETHNICITY.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim1-1.png" width="672"></p>
<p>There is not much differential impact, which makes sense given that <code>ETHNICITY</code> was not used in the amputation calculation (but there may certainly be interactions with other factors playing out here).</p>
<p>Next we’ll look at the interplay between FRL, ELL and missingness</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mosaicMiss</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    Test_Data_WIDE[[m]][,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"FREE_REDUCED_LUNCH_STATUS.2019"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ELL_STATUS.2019"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SCALE_SCORE.2021"</span>)],</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight =</span> <span class="dv">3</span>, <span class="at">plotvars =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">miss.labels =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim2-1.png" width="672"></p>
<p>Here we see that FRL and ELL students are more likely to be missing in 2021. This is very much the case for students who are both FRL and ELL. Too much so? We may need to change the <code>ampute.var.weights</code> to downweight particular variables.</p>
<p>Now we’ll look at missingness related to prior scale scores. First lets look at what we started with in the <code>SGPdata::sgpData_LONG_COVID</code>. We will widen it similar to the way we widened the amputed data above.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>  sgpData_WIDE_COVID <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    data_to_ampute[YEAR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2019"</span>, <span class="st">"2021"</span>) <span class="sc">&amp;</span> VALID_CASE <span class="sc">==</span> <span class="st">"VALID_CASE"</span>],</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">+</span> CONTENT_AREA <span class="sc">~</span> YEAR, <span class="at">sep=</span><span class="st">"."</span>, <span class="at">drop=</span><span class="cn">FALSE</span>, <span class="at">value.var=</span><span class="fu">c</span>(<span class="st">"GRADE"</span>, <span class="st">"SCALE_SCORE"</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">##    Trim things down with all NAs (79 cases) and fill in some missing info (partial.fill)</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  sgpData_WIDE_COVID <span class="ot">&lt;-</span> sgpData_WIDE_COVID[<span class="sc">!</span>(<span class="fu">is.na</span>(GRADE<span class="fl">.2019</span>) <span class="sc">&amp;</span> <span class="fu">is.na</span>(GRADE<span class="fl">.2021</span>))]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  sgpData_WIDE_COVID[<span class="fu">is.na</span>(GRADE<span class="fl">.2019</span>), GRADE<span class="fl">.2019</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(GRADE<span class="fl">.2021</span>)<span class="sc">-</span>2L]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  sgpData_WIDE_COVID[<span class="fu">is.na</span>(GRADE<span class="fl">.2021</span>), GRADE<span class="fl">.2021</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(GRADE<span class="fl">.2019</span>)<span class="sc">+</span>2L]</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  sgpData_WIDE_COVID <span class="ot">&lt;-</span> sgpData_WIDE_COVID[GRADE<span class="fl">.2021</span> <span class="sc">%in%</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  sgpData_WIDE_COVID <span class="ot">&lt;-</span> sgpData_WIDE_COVID[GRADE<span class="fl">.2019</span> <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>]</span></code></pre></div>
<p>Now we will create some plots from the unaltered data (note this is scores for all grades, and scale is not standardized)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">histMiss</span>(<span class="fu">as.data.frame</span>(sgpData_WIDE_COVID[, <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim3-1.png" width="672"></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">marginplot</span>(<span class="fu">as.data.frame</span>(sgpData_WIDE_COVID[, <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]))</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim3-2.png" width="672"></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scattmatrixMiss</span>(<span class="fu">as.data.frame</span>(sgpData_WIDE_COVID[, <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim3-3.png" width="672"></p>
<p>Compare those with what we have in one of our amputated datasets: Change <code>m</code> to see results from other amputations, and run the same plot types for unaltered/amputed data back to back.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][, <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>, <span class="at">only.miss=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim4-1.png" width="672"></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginplot</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][, <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]))</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim4-2.png" width="672"></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scattmatrixMiss</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][, <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim4-3.png" width="672"></p>
<p>What we see is that in the unaltered data the 2021 missing cases are more-or-less randomly distributed given 2019 observed scores. After amputation, however, the missing case distribution is heavily concentrated in lower prior score observations.</p>
<p>Check out similar plots for GRADE specific subsets:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">==</span> <span class="st">"8"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim5-1.png" width="672"></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginplot</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">==</span> <span class="st">"8"</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]))</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim5-2.png" width="672"></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scattmatrixMiss</span>(<span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">==</span> <span class="st">"8"</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]), <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim5-3.png" width="672"></p>
<p>Check status only grades for desired missing patterns:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicMiss</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">==</span> <span class="st">"3"</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"FREE_REDUCED_LUNCH_STATUS.2019"</span>, <span class="st">"ELL_STATUS.2019"</span>, <span class="st">"SCALE_SCORE.2021"</span>)],</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">highlight =</span> <span class="dv">3</span>, <span class="at">plotvars =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">miss.labels =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim6-1.png" width="672"></p>
<p>Lastly, we can look at the amputed data relative to what we know to be “true”. Even though we didn’t specify a MNAR missing pattern, we see that missingness is highly correlated with unobserved (current) score because we’ve used prior scores to determine the probability of missingness. Given their high correlation we see that play out in the amputed data as well.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim7-1.png" width="672"></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">==</span> <span class="st">"3"</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim7-2.png" width="672"></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">==</span> <span class="st">"8"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim7-3.png" width="672"></p>
<p>The “marginplot” shows that the “observed” 2021 scores are identical to the “actual” scores (blue dots along a perfect diagonal) - those are unaltered. The distribution of the missing scores is skewed towards the lower end of achievement according to the (red) boxplot.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim8-1.png" width="672"></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginplot</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]))</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim8-2.png" width="672"></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    GROWTH grades only</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][<span class="sc">!</span>GRADE<span class="fl">.2021</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"4"</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim8-3.png" width="672"></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginplot</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][<span class="sc">!</span>GRADE<span class="fl">.2021</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"4"</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]))</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim8-4.png" width="672"></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    STATUS grades only</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"4"</span>),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim8-5.png" width="672"></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginplot</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(Test_Data_WIDE[[m]][GRADE<span class="fl">.2021</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"4"</span>),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"SCALE_SCORE_COMPLETE.2021"</span>, <span class="st">"SCALE_SCORE.2021"</span>)]))</span></code></pre></div>
<p><img src="Simulating_Missing_Data_files/figure-html/vim8-6.png" width="672"></p>
</div>
<div id="missing-data-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#missing-data-analysis" class="anchor" aria-hidden="true"></a>Missing data analysis</h1>
<p>In the following we run through a quick pooling of the results from the 10 amputed data sets to see how they differ from the “known truth”. This analysis focuses on school mean scale scores by grade, but similar analyses can be used with different aggregates and/or using different variables of interest (e.g., SGPs) as well.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>school_means <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">length</span>(Test_Data_LONG))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="fu">seq</span>(MM)) {</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  sch_mean <span class="ot">&lt;-</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    Test_Data_LONG[[m]][YEAR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2019"</span>, <span class="st">"2021"</span>), <span class="fu">list</span>(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Mean_SS_SCHOOL =</span> <span class="fu">mean</span>(SCALE_SCORE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">SD_SS_SCHOOL =</span> <span class="fu">sd</span>(SCALE_SCORE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">Mean_SS_SCHOOL_COMPLETE =</span> <span class="fu">mean</span>(SCALE_SCORE_COMPLETE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">SD_SS_SCHOOL_COMPLETE =</span> <span class="fu">sd</span>(SCALE_SCORE_COMPLETE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">N =</span> .N, <span class="at">PRESENT =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(SCALE_SCORE)),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">MISSING =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(SCALE_SCORE))),</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>      keyby <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"YEAR"</span>, <span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>, <span class="st">"SCHOOL_NUMBER"</span>)]</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  school_means[[m]] <span class="ot">&lt;-</span> <span class="fu">dcast</span>(sch_mean, CONTENT_AREA <span class="sc">+</span> GRADE <span class="sc">+</span> SCHOOL_NUMBER <span class="sc">~</span> YEAR,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">"Mean_SS_SCHOOL"</span>, <span class="st">"SD_SS_SCHOOL"</span>, <span class="st">"Mean_SS_SCHOOL_COMPLETE"</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"SD_SS_SCHOOL_COMPLETE"</span>, <span class="st">"N"</span>, <span class="st">"PRESENT"</span>, <span class="st">"MISSING"</span>),</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep=</span><span class="st">"."</span>, <span class="at">drop=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>school_means <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(school_means)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>school_means[, <span class="fu">c</span>(<span class="st">"Mean_SS_SCHOOL_COMPLETE.2019"</span>, <span class="st">"SD_SS_SCHOOL_COMPLETE.2019"</span>) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setkeyv</span>(school_means, <span class="fu">c</span>(<span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>, <span class="st">"SCHOOL_NUMBER"</span>))</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>pooled_school_means <span class="ot">&lt;-</span> school_means[, <span class="fu">list</span>(</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_SS_SCHOOL__2019 =</span> <span class="fu">mean</span>(Mean_SS_SCHOOL<span class="fl">.2019</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="co"># Should all be the same</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_SD_SCHOOL__2019 =</span> <span class="fu">mean</span>(SD_SS_SCHOOL<span class="fl">.2019</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_SS_SCHOOL__2021 =</span> <span class="fu">mean</span>(Mean_SS_SCHOOL<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">SD_Mean_SS_SCHOOL__2021 =</span> <span class="fu">sd</span>(Mean_SS_SCHOOL<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_SD_SCHOOL__2021 =</span> <span class="fu">mean</span>(SD_SS_SCHOOL<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_SS_SCHOOL_COMPLETE__2021 =</span> <span class="fu">mean</span>(Mean_SS_SCHOOL_COMPLETE<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_SD_SCHOOL_COMPLETE__2021 =</span> <span class="fu">mean</span>(SD_SS_SCHOOL_COMPLETE<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Present =</span> <span class="fu">mean</span>(PRESENT<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Missing =</span> <span class="fu">mean</span>(MISSING<span class="fl">.2021</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)), keyby<span class="ot">=</span><span class="fu">c</span>(<span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>, <span class="st">"SCHOOL_NUMBER"</span>)]</span></code></pre></div>
<p>Now we take a quick look at the pooled results. In the first table we see that school mean scale scores have <strong>increased</strong> from 2019 to 2021. This is due in part to the removal of more lower achieving students, on average.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note this object has rows for each grade/content in all schools (grades 6-8 for elementary schools &amp; 3-5 for middle schools)</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  pooled_school_means[(<span class="sc">!</span><span class="fu">is.na</span>(Mean_SS_SCHOOL__2019) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Mean_SS_SCHOOL__2021)), <span class="co"># remove noted schools</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.list</span>(<span class="fu">round</span>(<span class="fu">summary</span>(Mean_SS_SCHOOL__2021<span class="sc">-</span>Mean_SS_SCHOOL__2019, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="dv">2</span>)),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  keyby<span class="ot">=</span><span class="fu">c</span>(<span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>)]</span></code></pre></div>
<pre><code>##    CONTENT_AREA GRADE   Min. 1st Qu. Median Mean 3rd Qu.  Max.
## 1:          ELA     3 -40.19   -7.10   1.12 2.36   11.09 50.72
## 2:          ELA     4 -31.74   -5.80  -0.06 1.57   10.15 43.54
## 3:          ELA     5 -41.45   -8.48   1.32 1.94   10.22 73.22
## 4:          ELA     6 -54.37   -7.18   3.44 1.46    9.57 56.05
## 5:          ELA     7 -34.31   -4.90   1.42 3.40   11.00 53.94
## 6:          ELA     8 -23.86   -5.78   2.98 3.98   12.74 42.31</code></pre>
<p>We can also look at how different the 2021 amputed mean scores are from the “true” mean scores. This shows us how biased the means are by the missing data (about 6 points too high, on average).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>  pooled_school_means[(<span class="sc">!</span><span class="fu">is.na</span>(Mean_SS_SCHOOL_COMPLETE__2021) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Mean_SS_SCHOOL__2021)),</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.list</span>(<span class="fu">round</span>(<span class="fu">summary</span>(Mean_SS_SCHOOL_COMPLETE__2021<span class="sc">-</span>Mean_SS_SCHOOL__2021, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="dv">2</span>)),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  keyby<span class="ot">=</span><span class="fu">c</span>(<span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>)]</span></code></pre></div>
<pre><code>##    CONTENT_AREA GRADE   Min. 1st Qu. Median  Mean 3rd Qu.  Max.
## 1:          ELA     3 -39.81   -9.30  -4.39 -6.42   -1.13  4.32
## 2:          ELA     4 -40.15   -9.28  -4.26 -6.35   -1.03  7.33
## 3:          ELA     5 -65.01   -9.43  -4.98 -6.55   -1.19 11.31
## 4:          ELA     6 -41.23   -8.76  -3.94 -5.99   -1.16 23.12
## 5:          ELA     7 -31.72   -9.54  -6.18 -7.58   -3.54 11.88
## 6:          ELA     8 -24.90   -8.55  -5.25 -6.69   -2.45  6.47</code></pre>
<p>In addition to the artificially inflated mean scores, the “true” variation in scores (within schools) is larger than in the amputed data.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>  pooled_school_means[(<span class="sc">!</span><span class="fu">is.na</span>(Mean_SD_SCHOOL_COMPLETE__2021) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Mean_SD_SCHOOL__2021)), <span class="co"># remove noted schools</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.list</span>(<span class="fu">round</span>(<span class="fu">summary</span>(Mean_SD_SCHOOL_COMPLETE__2021<span class="sc">-</span>Mean_SD_SCHOOL__2021, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="dv">2</span>)),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  keyby<span class="ot">=</span><span class="fu">c</span>(<span class="st">"CONTENT_AREA"</span>, <span class="st">"GRADE"</span>)]</span></code></pre></div>
<pre><code>##    CONTENT_AREA GRADE   Min. 1st Qu. Median Mean 3rd Qu.  Max.
## 1:          ELA     3 -10.03   -0.09   0.27 0.83    2.10 12.62
## 2:          ELA     4 -11.04   -0.31   0.27 0.73    1.55 16.98
## 3:          ELA     5 -16.85   -0.07   0.79 1.88    2.96 21.75
## 4:          ELA     6 -15.75   -0.03   0.63 1.31    2.11 27.09
## 5:          ELA     7  -6.42    0.28   1.10 2.71    3.25 35.95
## 6:          ELA     8  -7.35    0.00   0.84 1.24    1.79 18.29</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#function-arguments">Function Arguments</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#example-workflow-of-creating-missing-data">Example workflow of creating missing data</a></li>
      </ul>
</li>
      <li><a href="#missing-data-explorationvisualization">Missing data exploration/visualization</a></li>
      <li><a href="#missing-data-analysis">Missing data analysis</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="packagePages">
  <p><b>cfaTools</b> is a <a href="https://centerforassessment.github.io">Center for Assessment</a> thing.</p>
</div>

<div class="author">
  <p>Developed &amp; Maintained by <a href="https://github.com/dbetebenner"><img class="img-author" src="https://centerforassessment.github.io/assets/dbetebenner.png" height="20"> Damian W. Betebenner</a>, <a href="https://github.com/adamvi"><img class="img-author" src="https://centerforassessment.github.io/assets/adamvi.png" height="20"> Adam R. Van Iwaarden</a> &amp; <a href="https://github.com/ndadey"><img class="img-author" src="https://avatars0.githubusercontent.com/u/17909944" height="20"> Nathan Dadey</a>, Joseph Martineau.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98997021-1', 'auto');
  ga('send', 'pageview');
</script></footer>
</div>

  </body>
</html>
